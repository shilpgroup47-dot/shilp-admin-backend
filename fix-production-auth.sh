#!/bin/bash

echo "ğŸš¨ URGENT: Production server needs to be updated!"
echo ""
echo "Problem: Authentication middleware is blocking admin access"
echo "Solution: Upload these 2 fixed files to production server"
echo ""

echo "ğŸ“ Files to upload to cPanel File Manager:"
echo ""
echo "1ï¸âƒ£  src/services/adminService.js"
echo "   â†³ Fixed: Added 'type: admin' to JWT token payload"
echo ""
echo "2ï¸âƒ£  src/middleware/adminAuth.js" 
echo "   â†³ Fixed: Removed strict type checking that was causing 403 errors"
echo ""

echo "ğŸš€ Upload Steps:"
echo "1. Go to cPanel â†’ File Manager"
echo "2. Navigate to: /public_html/backend.shilpgroup.com/"
echo "3. Upload these files (overwrite existing):"
echo "   â€¢ src/services/adminService.js"
echo "   â€¢ src/middleware/adminAuth.js"
echo ""

echo "ğŸ”„ Restart Steps:"
echo "1. Go to cPanel â†’ Setup Node.js App"
echo "2. Find your app (backend.shilpgroup.com)"
echo "3. Click 'Restart' button"
echo ""

echo "âœ… Test After Upload:"
echo "â€¢ Login should work: POST /api/admin/login"
echo "â€¢ Profile should work: GET /api/admin/profile (with JWT token)"
echo "â€¢ All admin APIs should work with proper JWT token"
echo ""

echo "ğŸ”§ Alternative: If you have terminal access:"
echo "   cd /public_html/backend.shilpgroup.com"
echo "   # Upload the files first, then:"
echo "   pm2 restart all"
echo "   # OR"
echo "   killall node && node src/server.js"
echo ""

echo "âš ï¸  Current Issue: Production server has old middleware code"
echo "ğŸ¯ Fix: Upload the 2 files above and restart Node.js app"