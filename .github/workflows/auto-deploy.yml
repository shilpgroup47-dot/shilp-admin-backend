name: Auto Deploy Backend (FTP Only)

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¦ Checkout Repository
      uses: actions/checkout@v3

    - name: ğŸ“ Build Deployment Package
      run: |
        mkdir deploy_package
        cp -r src deploy_package/
        cp package.json deploy_package/
        cp package-lock.json deploy_package/
        cp .env.example deploy_package/.env
        cp auto-deploy.sh deploy_package/
        cp restart-app.sh deploy_package/
        cp -r uploads deploy_package/

        chmod +x deploy_package/*.sh

    - name: ğŸš€ Deploy via FTP
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ${{ secrets.CPANEL_FTP_SERVER }}
        username: ${{ secrets.CPANEL_FTP_USERNAME }}
        password: ${{ secrets.CPANEL_FTP_PASSWORD }}
        server-dir: ${{ secrets.CPANEL_FTP_SERVER_DIR }}
        local-dir: ./deploy_package/
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/.DS_Store
          **/Thumbs.db

    - name: ğŸ”„ Auto Restart via PHP Script (No SSH)
      run: |
        curl https://backend.shilpgroup.com/restart.php

    - name: ğŸ‰ Deployment Complete
      run: echo "âœ… FTP-only deploy completed successfully!"
